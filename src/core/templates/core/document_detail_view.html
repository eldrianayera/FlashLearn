{% extends 'base.html' %}

{% block title %}
  {{ document.name }}
{% endblock %}

{% block content %}
  <div class="max-w-3xl mx-auto py-10 px-4">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-6">
      <ol class="flex space-x-2 text-gray-500">
        <li>
          <a href="{% url 'courses' %}" class="hover:underline text-blue-600">Courses</a>
        </li>
        <li>/</li>
        <li>
          <a href="{% url 'course-detail' document.course.slug %}" class="hover:underline text-blue-600">{{ document.course.name }}</a>
        </li>
        <li>/</li>
        <li class="text-gray-700 font-medium">{{ document.name }}</li>
      </ol>
    </nav>

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold text-gray-900">{{ document.name }}</h1>
      <span class="text-sm text-gray-500">Added {{ document.created_at|date:'M d, Y' }}</span>
    </div>

    <!-- Quick Actions -->
    <div class="flex gap-2 mb-6">
      <!-- Edit -->
      <a href="{% url 'document-update' document.id %}" class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium shadow hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">Edit</a>

      <!-- Download -->
      {% if document.file %}
        <a href="{{ document.file.url }}" download class="inline-flex items-center px-4 py-2 rounded-lg bg-gray-100 text-gray-800 text-sm font-medium shadow hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300">Download</a>
      {% endif %}

      <!-- Delete -->
      <a href="{% url 'document-delete' document.id %}" class="inline-flex items-center px-4 py-2 rounded-lg bg-red-500 text-white text-sm font-medium shadow hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400" onclick="return confirm('Are you sure you want to delete this document?');">Delete</a>
    </div>

    <!-- Content -->
    {% if document.document_note %}
      <div class="space-y-6">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h2 class="font-semibold text-blue-800 mb-2">Note</h2>
          <p class="text-blue-900 text-sm leading-relaxed">{{ document.document_note }}</p>
        </div>
      </div>
    {% endif %}

    {% if document.summary %}
      <div class="mt-6">
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <h2 class="font-semibold text-green-800 mb-2">Summary</h2>
          <p class="text-green-900 text-sm leading-relaxed">{{ document.summary }}</p>
        </div>
      </div>
    {% endif %}

    <!-- Flashcards -->
    <div class="mt-10">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center gap-2">
          üß† Flashcards
          <span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">{{ document.flashcards.count }}</span>
        </h2>

        <a href="{% url 'flashcard-create' document.pk %}" class="inline-flex items-center gap-2 rounded-xl bg-blue-600 text-white text-sm font-medium px-4 py-2 shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
          <span class="text-base leading-none">‚ûï</span>
          <span>Create Flashcard</span>
        </a>
      </div>

      {% if document.flashcards.all %}
        <div class="grid md:grid-cols-2 gap-4">
          {% for fc in document.flashcards.all %}
            <article class="relative overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm hover:shadow-md transition-all duration-200">
              <!-- playful corner glow -->
              <div class="pointer-events-none absolute -right-10 -top-10 h-28 w-28 rounded-full bg-gradient-to-br from-indigo-100 to-pink-100 opacity-70 blur-2xl"></div>

              <!-- Q -->
              <details class="group">
                <summary class="flex items-start justify-between gap-3 cursor-pointer p-4">
                  <div class="min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="inline-flex items-center justify-center text-xs font-semibold text-indigo-700 bg-indigo-100 px-2 py-0.5 rounded-full">Q</span>
                      <h3 class="font-semibold text-gray-900 truncate">{{ fc.question }}</h3>
                    </div>
                    <p class="text-xs text-gray-500">Click to reveal the answer</p>
                  </div>
                  <span class="ml-auto text-gray-400 transition-transform group-open:rotate-180">‚åÑ</span>
                </summary>

                <!-- A -->
                <div class="px-4 pb-4">
                  <div class="rounded-lg border border-emerald-200 bg-emerald-50 p-3">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="inline-flex items-center justify-center text-xs font-semibold text-emerald-700 bg-emerald-100 px-2 py-0.5 rounded-full">A</span>
                      <span class="text-emerald-900 font-medium">Answer</span>
                    </div>
                    <p class="text-emerald-900 text-sm leading-relaxed">{{ fc.answer }}</p>
                  </div>
                </div>
              </details>

              <!-- Actions -->
              <div class="flex items-center justify-end gap-2 px-4 pb-4">
                <a href="{% url 'flashcard-update' fc.pk %}" class="inline-flex items-center gap-1 text-xs px-3 py-1.5 rounded-lg bg-blue-500 text-white hover:bg-blue-600">‚úèÔ∏è Edit</a>

                <form action="{% url 'flashcard-delete' fc.pk %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="inline-flex items-center gap-1 text-xs px-3 py-1.5 rounded-lg bg-red-500 text-white hover:bg-red-600" onclick="return confirm('Delete this flashcard?')">üóëÔ∏è Delete</button>
                </form>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="rounded-xl border border-dashed border-gray-300 p-6 text-center">
          <p class="text-gray-600 mb-3">No flashcards yet.</p>
          <a href="{% url 'flashcard-create' document.pk %}" class="inline-flex items-center gap-2 rounded-lg bg-blue-600 text-white text-sm font-medium px-4 py-2 shadow hover:bg-blue-700">‚ûï Create your first flashcard</a>
        </div>
      {% endif %}
    </div>

    <!-- Back -->
    <div class="mt-8">
      <a href="{% url 'course-detail' document.course.slug %}" class="inline-block px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">‚Üê Back to {{ document.course.name }}</a>
    </div>
  </div>
{% endblock %}
